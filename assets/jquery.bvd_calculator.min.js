/*!
 * BVD Calculator - v0.1.0 - 2014-07-25
 * http://bvdcalculator.garethcooper.com
 * Copyright (c) 2014 Gareth Cooper
 * Licensed GPLv2
 **/
!function(a){function b(b){inputForm=b.is("form")?b:b.parents("form.rx");var d="#"+inputForm.data("outputElement"),e="PLANO"==inputForm.find("#sph").val()?0:inputForm.find("#sph").val(),f=parseFloat(e),g="PLANO"==inputForm.find("#cyl").val()?0:inputForm.find("#cyl").val(),h=parseFloat(g),i=parseFloat(inputForm.find("#axis").val()),j=(a("#newBvd").val()-a("#originalBvd").val())/1e3,k=f/(1+f*j);if(isNaN(h)||isNaN(i)){var l=0==k?c(k):c(k)+" DS";a(d).html(l)}else{var m=(f+h)/(1+(f+h)*j)-k;a(d).html(c(k)+" / "+c(m)+" x "+i)}}function c(a){"PLANO"==a&&(a=0);var b=parseFloat(a);b=b.toFixed(2);var c;return c=b>0?"+"+b:0>b?b:0==b?"PLANO":""}function d(a){if(""==a)return e(axisInput,""),"";var b=Math.floor(parseFloat(a));return b}function e(a,b){a.next("small.error").remove(),""!=b?(a.parent("label").addClass("error"),a.after('<small class="error">'+b+"</small>")):a.parent("label").removeClass("error")}function f(b){var c=a(b.target);""==c.val()&&c.val("PLANO"),h(c)}function g(b){var c=a(b.target);"PLANO"==c.val()&&c.val(""),h(c)}function h(a){var d=parseFloat(a.val());a.val(c(a.val()));var f="";return"PLANO"==a.val()||""===a.val()?(e(a,""),void b(a)):("NaN"==typeof d&&(f="Not a number"),(d>40||-40>d)&&(f="Power out of normal range"),4*d!=Math.floor(4*d)&&(f="Power not multiple of 0.25"),e(a,f),void b(a))}function i(c){var f=a(c.target),g=parseFloat(f.val()),h="";return f.val(d(f.val())),""===g?void e(f,""):((0>g||g>180)&&(h="Axis out of range"),e(f,h),void b(f))}function j(){a(".rx").each(function(){b(a(this))})}a.fn.bvd_calculator=function(c){a.extend({},a.fn.bvd_calculator.defaults,c);return this.each(function(){sphereInput=a("#sph",this),cylInput=a("#cyl",this),axisInput=a("#axis",this),bvdInputs=a(".bvd"),a(this).data("outputElement","output"+a(this).attr("id")),sphereInput.on("focusout",f),cylInput.on("focusout",g),axisInput.on("focusout",i),bvdInputs.on("change",j),b(a(this))})},a.fn.bvd_calculator.defaults={sphereSelector:"#sph",cylSelector:"#cyl",axisSelector:"#axis",originalBvdSelector:"#originalBvd",newBvdSelector:"#newBvd"},a.bvd_calculator=function(){window.console.log("Start static method")},a.fn.bvd_calculator.toString=function(){return sph=a.fn.bvd_calculator.inputs.sphere.val(),cyl=a.fn.bvd_calculator.inputs.cyl.val(),axis=a.fn.bvd_calculator.inputs.axis.val(),sph+" / "+cyl+" x "+axis}}(jQuery);